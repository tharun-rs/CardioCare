<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial scale=1.0">

    <title>User</title>
    <link rel="icon" type="image/x-icon" href="/documents/images/icon.png">
    <link rel="stylesheet" href="/styles/admin_dashboard.css">
</head>

<body>
    <div class="container" style="grid-template: 1fr 1fr 1fr 1fr 1fr / 0.8fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
        <div class="sidebar" style="background-color: var(--indigo);">
            <div class="title">CardioCare</div>
            <div class="list">
                <div id="one"><a href="#">New Diagnosis</a></div>
                <div id="two"><a href="#">Opinion Requests</a></div>
                <div id="three"><a href="#">Diagnosis History</a></div>
            </div>
        </div>
        
        <div class="upperbar" style="column-gap: 55%;">
            <div class="heading">User Dashboard</div>
            <div class="profile" style="right: -5px;"><a style="margin: 0px; padding: 0px;" href="/logout"><img src="/documents/images/user.png"></a></div>
        </div>

        <div class="dash-body user">
            
                Upload ECG image to get diagnosed!<br><br>
                <div class="new-diag">
                    <form id="uploadForm" action="/user/upload" method="post" enctype="multipart/form-data">
                    <input type="file" id="ecg" name="ecg" accept=".jpg, .png, .jpeg" onchange="previewFile()">
                    <div id="file-preview"></div>
                </div>
                <br>
                <input id="getdiag" type="submit" value="get diagnosis">
            </form>
            <div id="diagnosisResult"></div>
        </div>
    </div>
    <script>
document.getElementById('getdiag').addEventListener('click', function(event) {
    event.preventDefault(); // Prevent the default form submission behavior
    var form = document.getElementById('uploadForm');
    var formData = new FormData(form);

    // Send the form data to the server using AJAX
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/user/upload');
    xhr.onload = function() {
        if (xhr.status === 200) {
            // Parse the response as JSON
            var response = JSON.parse(xhr.responseText);
            // Check if the 'class' field exists in the response
            if (response.class) {
                // Display the 'class' data on the page
                document.getElementById('diagnosisResult').innerText = 'Diagnosis: ' + response.class;
            } else {
                // If the 'class' field is not found, display an error message
                document.getElementById('diagnosisResult').innerText = 'Error: Class data not found in response';
            }
        } else {
            // Handle errors if any
            document.getElementById('diagnosisResult').innerText = 'Error: Predictor down, try again later!';
            console.error('Request failed. Status: ' + xhr.status);
        }
    };
    xhr.send(formData);
});


    function previewFile(){
        const preview = document.getElementById('file-preview');
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();

        reader.onloadend = function() {
            const img = new Image();
            img.src = reader.result;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '100%';
            preview.innerHTML = '';
            preview.appendChild(img);
        }

        if(file){
            reader.readAsDataURL(file);
        }
        else{
            preview.innerHTML = 'No file selected';
        }
    }

    </script>
</body>

</html>